// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enums based on actual database structure
enum UserRoleEnum {
  superadmin
  admin
  student
  faculty
  staff
  parent

  @@map("user_role_enum")
}

enum CardStatusEnum {
  active
  inactive

  @@map("card_status_enum")
}

enum ReissueReasonEnum {
  lost
  damaged
  stolen
  defective
  other

  @@map("reissue_reason_enum")
}

enum ReissueRequestStatusEnum {
  pending
  approved
  rejected
  completed

  @@map("reissue_request_status_enum")
}

enum FacultyTypeEnum {
  engineering
  management
  arts
  science
  medical
  law
  other

  @@map("faculty_type_enum")
}

enum ProgramTypeEnum {
  undergraduate
  postgraduate
  doctoral
  diploma
  certificate

  @@map("program_type_enum")
}

enum SectionStatusEnum {
  active
  inactive
  archived

  @@map("section_status_enum")
}

// Core Tables based on actual schema structure

model UserLogin {
  id                  String       @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  uid                 String       @unique @db.VarChar(32)
  email               String?      @unique @db.Citext
  phone               String?      @db.VarChar(20)
  profileImageS3Key   String?      @map("profile_image_s3_key")
  profileImage        String?      @map("profile_image") @db.VarChar(64)
  passwordHash        String       @map("password_hash")
  role                UserRoleEnum
  status              String       @default("active") @db.VarChar(32)
  lastLoginAt         DateTime?    @map("last_login_at") @db.Timestamptz(6)
  createdAt           DateTime     @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt           DateTime     @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  employeeDetails     EmployeeDetails?
  auditLogs           AuditLog[]
  cardsIssued         Card[]       @relation("IssuedBy")
  reissueRequestsMade ReissueRequest[] @relation("RequestedBy")
  reissueRequestsApproved ReissueRequest[] @relation("ApprovedBy")
  changesHistory      ChangeHistory[]
  departmentPermissions UserDepartmentPermission[]
  assignedDepartmentPermissions UserDepartmentPermission[] @relation("AssignedBy")
  
  // University structure relations
  headOfFaculties     FacultySchoolList[] @relation("HeadOfFaculty")
  headOfDepartments   Department[] @relation("HeadOfDepartment")
  programCoordinators Program[] @relation("ProgramCoordinator")
  classTeachers       Section[] @relation("ClassTeacher")
  studentLogin        StudentDetails? @relation("StudentLogin")
  parentLogin         ParentDetails? @relation("ParentLogin")
  approvedStudents    StudentDetails[] @relation("DataApprovedBy")

  @@map("user_login")
}

model EmployeeDetails {
  id              String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  userLoginId     String?   @unique @map("user_login_id") @db.Uuid
  firstName       String    @map("first_name") @db.VarChar(128)
  lastName        String?   @map("last_name") @db.VarChar(128)
  displayName     String?   @map("display_name") @db.VarChar(256)
  photoS3Key      String?   @map("photo_s3_key")
  photo           String?   @db.VarChar(64)
  empId           String?   @unique @map("emp_id") @db.VarChar(64)
  departmentId    String?   @map("department_id") @db.Uuid
  designation     String?   @db.VarChar(128)
  joinDate        DateTime? @map("join_date") @db.Date
  isActive        Boolean   @default(true) @map("is_active")
  metadata        Json      @default("{}")
  createdAt       DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt       DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  userLogin                   UserLogin?                  @relation(fields: [userLoginId], references: [id], onDelete: SetNull)
  department                  Department?                 @relation("DepartmentEmployees", fields: [departmentId], references: [id], onDelete: SetNull)
  cards                       Card[]
  reissueRequests             ReissueRequest[]
  admissionStaffRoles         AdmissionStaffRoles[]
  admissionStaffDetails       AdmissionStaffDetails[]
  admissionFacultyStaff       AdmissionFacultyStaff[]
  registrarStaffRoles         RegistrarStaffRoles[]
  registrarStaffDetails       RegistrarStaffDetails[]
  registrarFacultyStaff       RegistrarFacultyStaff[]
  hrTeachingStaffRoles        HrTeachingStaffRoles[]
  hrNonTeachingStaffRoles     HrNonTeachingStaffRoles[]
  hrTeachingStaffDetails      HrTeachingStaffDetails[]
  hrNonTeachingStaffDetails   HrNonTeachingStaffDetails[]

  @@map("employee_details")
}

model Card {
  id                String         @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  cardHolderType    String         @map("card_holder_type") @db.VarChar(32)
  employeeId        String?        @map("employee_id") @db.Uuid
  studentId         String?        @map("student_id") @db.Uuid
  parentId          String?        @map("parent_id") @db.Uuid
  rfidUid           String?        @unique @map("rfid_uid") @db.VarChar(128)
  rfidApproved      Boolean        @default(false) @map("rfid_approved")
  rfidReissue       Boolean        @default(false) @map("rfid_reissue")
  rfidReissueCount  Int            @default(0) @map("rfid_reissue_count")
  rfidUpdatedetail  Boolean        @default(false) @map("rfid_updatedetail")
  rfidImage         String?        @map("rfid_image") @db.VarChar(64)
  rfidIssueImages   String?        @map("rfid_issue_images") @db.VarChar(64)
  latestImageS3Key  String?        @map("latest_image_s3_key")
  photoS3Key        String?        @map("photo_s3_key")
  photo             String?        @db.VarChar(64)
  templateColorCode String?        @map("template_color_code") @db.VarChar(32)
  issuedAt          DateTime?      @map("issued_at") @db.Timestamptz(6)
  expiresAt         DateTime?      @map("expires_at") @db.Timestamptz(6)
  status            CardStatusEnum @default(active)
  issuedById        String?        @map("issued_by") @db.Uuid
  notes             String?
  createdAt         DateTime       @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime       @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  employee          EmployeeDetails? @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  student           StudentDetails?  @relation("StudentCards", fields: [studentId], references: [id], onDelete: Cascade)
  parent            ParentDetails?   @relation("ParentCards", fields: [parentId], references: [id], onDelete: Cascade)
  issuedBy          UserLogin?       @relation("IssuedBy", fields: [issuedById], references: [id], onDelete: SetNull)
  reissueRequests   ReissueRequest[]

  @@map("card")
}

model ReissueRequest {
  id             String                     @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  cardHolderType String                     @map("card_holder_type") @db.VarChar(32)
  employeeId     String?                    @map("employee_id") @db.Uuid
  studentId      String?                    @map("student_id") @db.Uuid
  parentId       String?                    @map("parent_id") @db.Uuid
  oldCardId      String?                    @map("old_card_id") @db.Uuid
  reason         String?
  reasonCode     String?                    @map("reason_code") @db.VarChar(64)
  isPaid         Boolean                    @default(false) @map("is_paid")
  proofS3Key     String?                    @map("proof_s3_key")
  status         String                     @default("pending") @db.VarChar(32)
  requestedById  String?                    @map("requested_by") @db.Uuid
  approvedById   String?                    @map("approved_by") @db.Uuid
  approvedAt     DateTime?                  @map("approved_at") @db.Timestamptz(6)
  createdAt      DateTime                   @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt      DateTime                   @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  employee       EmployeeDetails?           @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  student        StudentDetails?            @relation("StudentReissueRequests", fields: [studentId], references: [id], onDelete: Cascade)
  parent         ParentDetails?             @relation("ParentReissueRequests", fields: [parentId], references: [id], onDelete: Cascade)
  oldCard        Card?                      @relation(fields: [oldCardId], references: [id], onDelete: SetNull)
  requestedBy    UserLogin?                 @relation("RequestedBy", fields: [requestedById], references: [id], onDelete: SetNull)
  approvedBy     UserLogin?                 @relation("ApprovedBy", fields: [approvedById], references: [id], onDelete: SetNull)

  @@map("reissue_request")
}

model AuditLog {
  id          String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  actorId     String?   @map("actor_id") @db.Uuid
  action      String    @db.VarChar(256)
  targetTable String?   @map("target_table") @db.VarChar(128)
  targetId    String?   @map("target_id") @db.Uuid
  details     Json      @default("{}")
  ipAddress   String?   @map("ip_address") @db.Inet
  userAgent   String?   @map("user_agent")
  createdAt   DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)

  // Relations
  actor       UserLogin? @relation(fields: [actorId], references: [id], onDelete: SetNull)

  @@map("audit_log")
}

model ChangeHistory {
  id          String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  tableId     String    @map("table_id") @db.Uuid
  tableName   String    @map("table_name") @db.VarChar(128)
  columnName  String    @map("column_name") @db.VarChar(128)
  oldValue    String?   @map("old_value")
  newValue    String?   @map("new_value")
  changedById String    @map("changed_by_id") @db.Uuid
  changeType  String    @map("change_type") @db.VarChar(32)
  changedAt   DateTime  @default(now()) @map("changed_at") @db.Timestamptz(6)

  // Relations
  changedBy   UserLogin @relation(fields: [changedById], references: [id])

  @@map("changes_history")
}

// Department-specific role tables based on actual database structure

// Admission Staff
model AdmissionStaffRoles {
  id               String          @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  employeeId       String          @map("employee_id") @db.Uuid
  title            String          @db.VarChar(256)
  canViewAll       Boolean         @default(false) @map("can_view_all")
  canModifyAll     Boolean         @default(false) @map("can_modify_all")
  specialPermissions Json          @default("{}") @map("special_permissions")
  createdAt        DateTime        @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime        @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  employee         EmployeeDetails @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("admission_staff_roles")
}

model AdmissionStaffDetails {
  id               String          @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  employeeId       String          @map("employee_id") @db.Uuid
  workLocation     String?         @map("work_location") @db.VarChar(256)
  supervisor       String?         @db.VarChar(256)
  responsibleFor   String?         @map("responsible_for") @db.VarChar(256)
  admissionCycle   String?         @map("admission_cycle") @db.VarChar(64)
  metadata         Json            @default("{}")
  createdAt        DateTime        @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime        @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  employee         EmployeeDetails @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("admission_staff_details")
}

model AdmissionFacultyStaff {
  id               String          @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  employeeId       String          @map("employee_id") @db.Uuid
  facultyType      String?         @map("faculty_type") @db.VarChar(128)
  qualification    String?         @db.VarChar(256)
  experience       String?         @db.VarChar(256)
  specialization   String?         @db.VarChar(256)
  responsibilities String?         @db.VarChar(512)
  metadata         Json            @default("{}")
  createdAt        DateTime        @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime        @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  employee         EmployeeDetails @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("admission_faculty_staff")
}

// Registrar Staff
model RegistrarStaffRoles {
  id               String          @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  employeeId       String          @map("employee_id") @db.Uuid
  title            String          @db.VarChar(256)
  canViewAll       Boolean         @default(false) @map("can_view_all")
  canModifyAll     Boolean         @default(false) @map("can_modify_all")
  specialPermissions Json          @default("{}") @map("special_permissions")
  createdAt        DateTime        @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime        @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  employee         EmployeeDetails @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("registrar_staff_roles")
}

model RegistrarStaffDetails {
  id               String          @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  employeeId       String          @map("employee_id") @db.Uuid
  workLocation     String?         @map("work_location") @db.VarChar(256)
  supervisor       String?         @db.VarChar(256)
  responsibleFor   String?         @map("responsible_for") @db.VarChar(256)
  accessLevel      String?         @map("access_level") @db.VarChar(64)
  metadata         Json            @default("{}")
  createdAt        DateTime        @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime        @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  employee         EmployeeDetails @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("registrar_staff_details")
}

model RegistrarFacultyStaff {
  id               String          @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  employeeId       String          @map("employee_id") @db.Uuid
  facultyType      String?         @map("faculty_type") @db.VarChar(128)
  qualification    String?         @db.VarChar(256)
  experience       String?         @db.VarChar(256)
  specialization   String?         @db.VarChar(256)
  responsibilities String?         @db.VarChar(512)
  metadata         Json            @default("{}")
  createdAt        DateTime        @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime        @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  employee         EmployeeDetails @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("registrar_faculty_staff")
}

// HR Staff
model HrTeachingStaffRoles {
  id               String          @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  employeeId       String          @map("employee_id") @db.Uuid
  title            String          @db.VarChar(256)
  canViewAll       Boolean         @default(false) @map("can_view_all")
  canModifyAll     Boolean         @default(false) @map("can_modify_all")
  specialPermissions Json          @default("{}") @map("special_permissions")
  createdAt        DateTime        @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime        @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  employee         EmployeeDetails @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("hr_teaching_staff_roles")
}

model HrNonTeachingStaffRoles {
  id               String          @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  employeeId       String          @map("employee_id") @db.Uuid
  title            String          @db.VarChar(256)
  canViewAll       Boolean         @default(false) @map("can_view_all")
  canModifyAll     Boolean         @default(false) @map("can_modify_all")
  specialPermissions Json          @default("{}") @map("special_permissions")
  createdAt        DateTime        @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime        @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  employee         EmployeeDetails @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("hr_non_teaching_staff_roles")
}

model HrTeachingStaffDetails {
  id               String          @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  employeeId       String          @map("employee_id") @db.Uuid
  qualification    String?         @db.VarChar(256)
  experience       String?         @db.VarChar(256)
  specialization   String?         @db.VarChar(256)
  currentPosting   String?         @map("current_posting") @db.VarChar(256)
  salaryGrade      String?         @map("salary_grade") @db.VarChar(64)
  metadata         Json            @default("{}")
  createdAt        DateTime        @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime        @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  employee         EmployeeDetails @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("hr_teaching_staff_details")
}

model HrNonTeachingStaffDetails {
  id               String          @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  employeeId       String          @map("employee_id") @db.Uuid
  qualification    String?         @db.VarChar(256)
  experience       String?         @db.VarChar(256)
  skillSet         String?         @map("skill_set") @db.VarChar(256)
  currentPosting   String?         @map("current_posting") @db.VarChar(256)
  salaryGrade      String?         @map("salary_grade") @db.VarChar(64)
  metadata         Json            @default("{}")
  createdAt        DateTime        @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime        @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  employee         EmployeeDetails @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("hr_non_teaching_staff_details")
}

// Department Permission System
enum DepartmentEnum {
  ADMISSION
  REGISTRAR
  HR_TEACHING
  HR_NON_TEACHING

  @@map("department_enum")
}

model UserDepartmentPermission {
  id           String         @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  userId       String         @map("user_id") @db.Uuid
  department   DepartmentEnum
  permissions  Json           @default("{}") // Store permissions as JSON object
  isActive     Boolean        @default(true) @map("is_active")
  assignedBy   String?        @map("assigned_by") @db.Uuid
  assignedAt   DateTime       @default(now()) @map("assigned_at") @db.Timestamptz(6)
  createdAt    DateTime       @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt    DateTime       @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  user         UserLogin      @relation(fields: [userId], references: [id], onDelete: Cascade)
  assignedByUser UserLogin?   @relation("AssignedBy", fields: [assignedBy], references: [id], onDelete: SetNull)

  @@unique([userId, department])
  @@map("user_department_permission")
}

// University Structure Tables
model FacultySchoolList {
  id                String         @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  facultyCode       String         @unique @map("faculty_code") @db.VarChar(32)
  facultyName       String         @map("faculty_name") @db.VarChar(256)
  facultyType       FacultyTypeEnum @map("faculty_type")
  shortName         String?        @map("short_name") @db.VarChar(64)
  description       String?
  establishedYear   Int?           @map("established_year")
  headOfFacultyId   String?        @map("head_of_faculty") @db.Uuid
  contactEmail      String?        @map("contact_email") @db.Citext
  contactPhone      String?        @map("contact_phone") @db.VarChar(20)
  officeLocation    String?        @map("office_location")
  websiteUrl        String?        @map("website_url")
  isActive          Boolean        @default(true) @map("is_active")
  metadata          Json           @default("{}") @db.JsonB
  createdAt         DateTime       @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime       @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  headOfFaculty     UserLogin?     @relation("HeadOfFaculty", fields: [headOfFacultyId], references: [id], onDelete: SetNull)
  departments       Department[]

  @@map("faculty_school_list")
}

model Department {
  id                  String            @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  facultyId           String            @map("faculty_id") @db.Uuid
  departmentCode      String            @unique @map("department_code") @db.VarChar(32)
  departmentName      String            @map("department_name") @db.VarChar(256)
  shortName           String?           @map("short_name") @db.VarChar(64)
  description         String?
  establishedYear     Int?              @map("established_year")
  headOfDepartmentId  String?           @map("head_of_department") @db.Uuid
  contactEmail        String?           @map("contact_email") @db.Citext
  contactPhone        String?           @map("contact_phone") @db.VarChar(20)
  officeLocation      String?           @map("office_location")
  budgetAllocation    Decimal?          @map("budget_allocation") @db.Decimal(15, 2)
  isActive            Boolean           @default(true) @map("is_active")
  metadata            Json              @default("{}") @db.JsonB
  createdAt           DateTime          @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt           DateTime          @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  faculty             FacultySchoolList @relation(fields: [facultyId], references: [id], onDelete: Cascade)
  headOfDepartment    UserLogin?        @relation("HeadOfDepartment", fields: [headOfDepartmentId], references: [id], onDelete: SetNull)
  programs            Program[]
  employees           EmployeeDetails[] @relation("DepartmentEmployees")

  @@map("department")
}

model Program {
  id                    String          @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  departmentId          String          @map("department_id") @db.Uuid
  programCode           String          @unique @map("program_code") @db.VarChar(32)
  programName           String          @map("program_name") @db.VarChar(256)
  programType           ProgramTypeEnum @map("program_type")
  shortName             String?         @map("short_name") @db.VarChar(64)
  description           String?
  durationYears         Int             @default(4) @map("duration_years")
  durationSemesters     Int             @default(8) @map("duration_semesters")
  totalCredits          Int?            @map("total_credits")
  admissionCapacity     Int             @default(0) @map("admission_capacity")
  currentEnrollment     Int             @default(0) @map("current_enrollment")
  programCoordinatorId  String?         @map("program_coordinator") @db.Uuid
  accreditationBody     String?         @map("accreditation_body") @db.VarChar(128)
  accreditationStatus   String?         @map("accreditation_status") @db.VarChar(64)
  isActive              Boolean         @default(true) @map("is_active")
  metadata              Json            @default("{}") @db.JsonB
  createdAt             DateTime        @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt             DateTime        @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  department            Department      @relation(fields: [departmentId], references: [id], onDelete: Cascade)
  programCoordinator    UserLogin?      @relation("ProgramCoordinator", fields: [programCoordinatorId], references: [id], onDelete: SetNull)
  sections              Section[]
  students              StudentDetails[]

  @@map("program")
}

model Section {
  id               String            @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  programId        String            @map("program_id") @db.Uuid
  sectionCode      String            @map("section_code") @db.VarChar(32)
  sectionName      String            @map("section_name") @db.VarChar(128)
  academicYear     String            @map("academic_year") @db.VarChar(16)
  semester         Int
  batchYear        Int               @map("batch_year")
  capacity         Int               @default(60)
  currentStrength  Int               @default(0) @map("current_strength")
  classTeacherId   String?           @map("class_teacher") @db.Uuid
  roomNumber       String?           @map("room_number") @db.VarChar(64)
  timetableSlot    String?           @map("timetable_slot") @db.VarChar(32)
  status           SectionStatusEnum @default(active)
  metadata         Json              @default("{}") @db.JsonB
  createdAt        DateTime          @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime          @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  program          Program           @relation(fields: [programId], references: [id], onDelete: Cascade)
  classTeacher     UserLogin?        @relation("ClassTeacher", fields: [classTeacherId], references: [id], onDelete: SetNull)
  students         StudentDetails[]

  @@unique([programId, sectionCode, academicYear, semester])
  @@map("section")
}

model StudentDetails {
  id                     String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userLoginId            String?   @unique @map("user_login_id") @db.Uuid
  studentId              String    @unique @map("student_id") @db.VarChar(64)
  firstName              String    @map("first_name") @db.VarChar(128)
  lastName               String?   @map("last_name") @db.VarChar(128)
  displayName            String?   @map("display_name") @db.VarChar(256)
  registrationNo         String?   @unique @map("registration_no") @db.VarChar(64)
  middleName             String?   @map("middle_name") @db.VarChar(128)
  email                  String?   @unique @db.VarChar(256)
  phone                  String?   @db.VarChar(15)
  photoS3Key             String?   @map("photo_s3_key")
  photo                  String?   @db.VarChar(64)
  sectionId              String    @map("section_id") @db.Uuid
  programId              String?   @map("program_id") @db.Uuid
  rollNumber             String?   @map("roll_number") @db.VarChar(32)
  admissionDate          DateTime? @map("admission_date") @db.Date
  graduationDate         DateTime? @map("graduation_date") @db.Date
  currentSemester        Int       @default(1) @map("current_semester")
  cgpa                   Decimal?  @db.Decimal(4, 2)
  attendancePercentage   Decimal?  @map("attendance_percentage") @db.Decimal(5, 2)
  parentContact          String?   @map("parent_contact") @db.VarChar(20)
  emergencyContact       String?   @map("emergency_contact") @db.VarChar(20)
  address                String?
  dateOfBirth            DateTime? @map("date_of_birth") @db.Date
  gender                 String?   @db.VarChar(16)
  bloodGroup             String?   @map("blood_group") @db.VarChar(8)
  // Approval workflow fields
  dataEntryStatus        String    @default("pending") @map("data_entry_status") @db.VarChar(32)
  dataApprovedById       String?   @map("data_approved_by") @db.Uuid
  dataApprovedAt         DateTime? @map("data_approved_at") @db.Timestamptz(6)
  approvalComments       String?   @map("approval_comments")
  photoCaptureAllowed    Boolean   @default(false) @map("photo_capture_allowed")
  cardPrintAllowed       Boolean   @default(false) @map("card_print_allowed")
  photoPath              String?   @map("photo_path") @db.VarChar(512)
  photoCapturedAt        DateTime? @map("photo_captured_at") @db.Timestamptz(6)
  photoCapturedBy        String?   @map("photo_captured_by") @db.Uuid
  isActive               Boolean   @default(true) @map("is_active")
  metadata               Json      @default("{}") @db.JsonB
  createdAt              DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt              DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  userLogin              UserLogin? @relation("StudentLogin", fields: [userLoginId], references: [id], onDelete: SetNull)
  section                Section    @relation(fields: [sectionId], references: [id], onDelete: Cascade)
  program                Program?   @relation(fields: [programId], references: [id], onDelete: SetNull)
  dataApprovedBy         UserLogin? @relation("DataApprovedBy", fields: [dataApprovedById], references: [id], onDelete: SetNull)
  parents                ParentDetails[]
  cards                  Card[]     @relation("StudentCards")
  reissueRequests        ReissueRequest[] @relation("StudentReissueRequests")

  @@map("student_details")
}

model ParentDetails {
  id                String     @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  userLoginId       String?    @unique @map("user_login_id") @db.Uuid
  studentId         String     @map("student_id") @db.Uuid
  relationship      String     @db.VarChar(32)
  firstName         String     @map("first_name") @db.VarChar(128)
  lastName          String?    @map("last_name") @db.VarChar(128)
  occupation        String?    @db.VarChar(128)
  organization      String?    @db.VarChar(256)
  phone             String?    @db.VarChar(20)
  email             String?    @db.Citext
  address           String?
  isPrimaryContact  Boolean    @default(false) @map("is_primary_contact")
  isActive          Boolean    @default(true) @map("is_active")
  metadata          Json       @default("{}") @db.JsonB
  createdAt         DateTime   @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime   @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  userLogin         UserLogin? @relation("ParentLogin", fields: [userLoginId], references: [id], onDelete: SetNull)
  student           StudentDetails @relation(fields: [studentId], references: [id], onDelete: Cascade)
  cards             Card[]     @relation("ParentCards")
  reissueRequests   ReissueRequest[] @relation("ParentReissueRequests")

  @@map("parent_details")
}